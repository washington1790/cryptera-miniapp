<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>P2P</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: -apple-system, sans-serif; background: #1C1C1E; color: #FFF; margin: 20px; }
    .container { max-width: 500px; margin: 0 auto; }
    input, button, select {
      width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: none; font-size: 16px;
    }
    input, select { background: #2C2C2E; color: #FFF; }
    button { background: #0A84FF; color: white; font-weight: 600; }
    .ad {
      background: #2C2C2E;
      padding: 16px;
      border-radius: 12px;
      margin: 10px 0;
      border-left: 4px solid #30D158;
    }
    .ad.sell { border-left-color: #FF453A; }
    .ad-header { font-weight: 600; margin-bottom: 6px; }
    .ad-price { color: #FFD700; }
    .actions button {
      padding: 8px; margin: 5px 0; background: #3A3A3C; font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üë• P2P –¢–æ—Ä–≥–æ–≤–ª—è</h2>

    <button onclick="toggleForm()">‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>

    <div id="createForm" style="display: none; margin-bottom: 20px; padding: 16px; background: #2C2C2E; border-radius: 12px;">
      <select id="adType">
        <option value="buy">–Ø —Ö–æ—á—É –∫—É–ø–∏—Ç—å</option>
        <option value="sell">–Ø —Ö–æ—á—É –ø—Ä–æ–¥–∞—Ç—å</option>
      </select>
      <input type="text" id="crypto" placeholder="–ú–æ–Ω–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, TON)" value="TON">
      <input type="number" id="amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" step="0.0001">
      <input type="number" id="price" placeholder="–¶–µ–Ω–∞ –∑–∞ 1 (USDT)" step="0.01" value="2.00">
      <button onclick="createAd()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>

    <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä—ã</h3>
    <div id="adsList"></div>
  </div>

  <script>
    let ads = [
      { id: 1, type: 'buy', crypto: 'TON', amount: 50, price: 1.95, user: 'User123' },
      { id: 2, type: 'sell', crypto: 'USDT', amount: 1000, price: 2.05, user: 'Anon777' }
    ];

    function toggleForm() {
      const form = document.getElementById('createForm');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function createAd() {
      const type = document.getElementById('adType').value;
      const crypto = document.getElementById('crypto').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const price = parseFloat(document.getElementById('price').value);

      if (!crypto || !amount || !price) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
      }

      const newAd = {
        id: Date.now(),
        type,
        crypto: crypto.toUpperCase(),
        amount,
        price,
        user: '–í—ã'
      };

      ads.push(newAd);
      renderAds();
      toggleForm();
      document.getElementById('amount').value = '';
      document.getElementById('price').value = '';
    }

    function renderAds() {
      const container = document.getElementById('adsList');
      container.innerHTML = ads.map(ad => `
        <div class="ad ${ad.type === 'sell' ? 'sell' : ''}">
          <div class="ad-header">
            ${ad.type === 'buy' ? 'üü¢ –ö—É–ø–ª—é' : 'üî¥ –ü—Ä–æ–¥–∞–º'} ${ad.crypto}
          </div>
          <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <b>${ad.amount}</b></div>
          <div class="ad-price">–¶–µ–Ω–∞: ${ad.price} USDT</div>
          <div>–û—Ç: <i>@${ad.user}</i></div>
          <div class="actions">
            <button onclick="contact(${ad.id})">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å</button>
            <button onclick="trade(${ad.id})">ü§ù –°–¥–µ–ª–∫–∞</button>
          </div>
        </div>
      `).join('');
    }

    function contact(id) {
      const ad = ads.find(a => a.id === id);
      alert('üì© –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @' + ad.user + '\n(–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî —á–µ—Ä–µ–∑ Telegram)');
    }

    function trade(id) {
      const ad = ads.find(a => a.id === id);
      const total = (ad.amount * ad.price).toFixed(2);
      const confirm = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å ${ad.amount} ${ad.crypto} –∑–∞ ${total} USDT?');
      if (confirm) {
        alert('‚úÖ –°–¥–µ–ª–∫–∞ –Ω–∞—á–∞—Ç–∞!\n–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ —á–∞—Ç–µ.');
        parent.updateBalance(parent.balance - total);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderAds();
  </script>
</body>
</html>
